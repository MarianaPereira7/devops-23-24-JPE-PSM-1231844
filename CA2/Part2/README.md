# Class Assignment 2: Build Tools with Gradle - Part 1

## Overview
The goal of this class assignment was to keep learning how to use Gradle, by reusing the final source code of the first
Class Assignment, which is available [**here**](https://github.com/MarianaPereira7/devops-23-24-JPE-PSM-1231844/tree/main/CA1).
It was proposed to use **spring initializr**, which is a web-based tool provided by the Spring team for quickly generating the 
initial structure of a Spring Boot project. Then more tasks were created to was used in order to 

**For this assignment three main goals are predicted:**
* Convert the provided application to Gradle, instead of Maven;
* Create a new branch to fulfil the assignment;
* Continue to explore/practice gradle, by adding more tasks and relevant plugins;
* Explore an alternative build tool apart from Gradle.

<br>

**Important notes:**
* Main tasks were identified and issues were created in accordance on GitHub. Once the issue was solved,
  it was closed and linked to a specific commit (the web version of GitHub was used);
* The repository containing all the work developed for this assignment can be found [**here**](https://github.com/MarianaPereira7/devops-23-24-JPE-PSM-1231844/tree/main/CA2/Part2).

<br>

Considering this assignment's objectives, the following issues were created (numbers are relative to this assignment and
only, not considering the autogenerated issue numbers by GitHub):

| Issue Number |                           Description                            |
|:------------:|:----------------------------------------------------------------:|
|    **#1**    |       Create a new branch to develop the class assignment        |
|    **#2**    | Create a task to copy the generated jar file to a defined folder |
|    **#3**    |    Create a task to delete all the files generated by webpack    |
|    **#4**    |                 Explore an alternative solution                  |
|    **#5**    |        Add readme file and mark the end of the assignment        |

<br>

---

## Table of Contents

1. [Part 1: Setting Up the Environment for the Assignment](#part-1-setting-up-the-environment-for-the-assignment)
    - [1.1 Create a new branch](#11-create-a-new-branch)
    - [1.2 Use spring initializr tool](#12-use-spring-initializr-tool)
    - [1.3 Arrange the project files](#13-arrange-the-project-files)
    - [1.4 Add the frontend plugin and its configuration](#14-add-the-frontend-plugin-and-its-configuration)
2. [Part 2: Assignment Tasks](#part-2-assignment-tasks)
    - [2.1 Add a task to copy the generated jar file](#21-add-a-task-to-copy-the-generated-jar-file)
    - [2.2 Add a task to delete all the files generated by webpack](#22-add-a-task-to-delete-all-the-files-generated-by-webpack)
    - [2.3 Merge tut-basic-gradle branch with main](#23-merge-tut-basic-gradle-branch-with-main)
3. [Part 3: Explore an Alternative Solution](#part-3-explore-an-alternative-solution)
4. [Useful Sources](#4-useful-sources)

<br>

---
## Part 1: Setting Up the Environment for the Assignment

### 1.1 Create a new branch
This assignment is supposed to be developed in a separate branch called `tut-basic-gradle`. Open git bash on repository and
run the following set of commands, in order to in order to create a new branch called tut-basic-gradle in your local repository, 
switch your working directory to the new branch to start working on it and, finally, push it to the remote repository to 
start tracking the new local branch.

```bash
$ git branch tut-basic-gradle
$ git checkout tut-basic-gradle
$ git push -u origin tut-basic-gradle
```

### 1.2 Use spring initializr tool
To start the new project, it was required to use the spring initializr tool in order to quickly generate the initial structure of 
the Spring Boot project. By doing so, it will generate the necessary dependencies, configuration, and directory structure.
Use this link and fill the required fields as it is displayed in the image below:

![spring_initializr.png](react-and-spring-data-rest-basic/images/spring_initializr.png)

Then, in the `ADD DEPENDENCIES` field, select add Rest Repositories, Thymeleaf, JPA and H2 as dependencies ofr the current project.
Below there is a brief explanation of each one:
* **Rest Repositories:**  
Also known as Spring Data REST repositories, are a feature of the Spring Data project that automatically expose JPA 
repositories as RESTful endpoints. They enable CRUD (Create, Read, Update, Delete) operations over HTTP using standard 
RESTful conventions, allowing easy access to data without writing explicit controller code.

* **Thymeleaf:**  
Thymeleaf is a Java-based templating engine commonly used in web development. It allows developers to create dynamic and 
interactive web pages by seamlessly integrating server-side logic with HTML templates. Thymeleaf templates can be processed 
both on the server side and in the client's browser, making it versatile for various web application architectures.

* **JPA:**  
Java Persistence API, is a Java specification for accessing, persisting, and managing data between Java objects 
and relational databases. With JPA, developers can define entity classes to represent database tables, annotate them to map 
to database columns, and use EntityManager to perform CRUD operations.

* **H2:**  
An open-source relational database management system written in Java. It's known for its fast performance, 
small footprint, and easy setup, making it popular for development, testing, and prototyping purposes. 
H2 supports SQL queries and provides features like transactions, indexes, and stored procedures.


Finally, click on `GENERATE`, where a zip file will be generated. Extract the contents to an empty folder on your repository.
A spring application can now be built using gradle. If you wish to see the available gradle tasks, you
can do so by executing the `./gradlew tasks` command.

### 1.3 Arrange the project files
As mentioned before, this assignment uses the source code of the first class assignment present in the current repository.
Start by deleting the `/src` folder and  all of its contents and then go to this [link](https://github.com/MarianaPereira7/devops-23-24-JPE-PSM-1231844/tree/main/CA1/tut-react-and-spring-data-rest/basic)
to manage the required files:
* copy the proper source code (`/src` folder);
* copy `webpack.config.js` and `package.json` files;
* delete the folder `src/main/resources/static/built/`.

Some compilation errors might occur in the `Employee.java` file, but you can easily resolve it by changing the class imports to the following:
```java
import javax.persistence.Entity;
import javax.persistence.GeneratedValue;
import javax.persistence.Id;
```

### 1.4 Add the frontend plugin and its configuration
At the moment, when running the application and launching the browser, the web page shows no results (is empty). There is the
need to add a plugin to deal with the frontend code. There are several plugins used to handle frontend-related tasks within Gradle builds, 
but the chosen one was the `org.siouan.frontend` plugin. To properly add this plugin to, open the build.gradle file and add 
it to the plugins block. Since version 17 of Java was used for the current project, the following line was added to the projects configuration file:
```groovy
id "org.siouan.frontend-jdk17" version "8.0.0"
```

Finally, for the plugin to fulfil its purpose for the current project, add the following configuration to the build.gradle file:
```groovy
frontend {
    nodeVersion = "16.20.2"
    assembleScript = "run build"
    cleanScript = "run clean"
    checkScript = "run check"
}
```

And also add the following information to the `package.json` file to properly configure the execution of the webpack:
```
"packageManager": "npm@9.6.7",
  "scripts": {
    "webpack": "webpack",
    "build": "npm run webpack",
    "check": "echo Checking frontend",
    "clean": "echo Cleaning frontend",
    "lint": "echo Linting frontend",
    "test": "echo Testing frontend"
  }
```
Some relevant information:
* The package.json file is used in Node.js projects to manage project dependencies, scripts and metadata;
* The `packageManager` entry specifies the version of the package manager to be used for installing dependencies. In this case, 
"npm@9.6.7", indicates that npm version 9.6.7 should be used. This version specification ensures consistency across different 
npm installations and environments.


---
## Part 2: Assignment Tasks

### 2.1 Add a task to copy the generated jar file
To copy the generated jar file which results from the building process and is located at `build/libs` directory, the following
task can be added to the build.gradel script file:

```groovy
task copyJarFile(type:Copy, dependsOn:bootJar){
	group = "Backup"
	description = "Copies the generated jar file to a folder named 'dist' located at the project root folder level."
	from 'build/libs'
	into 'dist'
	include '*.jar'
}
```
In this task, the intended jar files are copied to a new folder called `dist` located at the project root level.
A dependency to the `bootJar` class was added, meaning that before executing the `copyJarFile` task, Gradle will ensure that 
the `bootJar` task is executed first.   
Running `./gradlew tasks` command again, it is possible to verify that the new task was assigned to the `Backup tasks` group.

![backup_group](react-and-spring-data-rest-basic/images/backup_group.png)  
  
Now, if running `./gradlew copyJarFile`, the tasks works as expected.

|                      Before running the copyJarFile task                       |                      After running the copyJarFile task                       |
|:------------------------------------------------------------------------------:|:-----------------------------------------------------------------------------:|
| ![before](react-and-spring-data-rest-basic/images/before_copyJarFile_task.png) | ![after](react-and-spring-data-rest-basic/images/after_copyJarFile_task.png) |

<br>

### 2.2 Add a task to delete all the files generated by webpack
Webpack is typically used in front-end web development projects to bundle and manage JavaScript, CSS, and other 
static assets. The process of generating webpack files usually occurs during the project's build phase, specifically during 
the packaging phase or as part of a custom build script. The generated files are usually located at `src/main/resources/static/built/`,
so, in order to delete this content, the task below was written in the `build.gradle` script file:

```groovy
task cleanWebpackFiles(type:Delete){
   group = "Build"
   description = "Deletes the generated webpack files."
   delete 'src/main/resources/static/built/'
}
```

Running `./gradlew tasks` command again, it is possible to verify that the new task was assigned to the `Build tasks` group.

![backup_tasks](react-and-spring-data-rest-basic/images/build_tasks.png)  
  

Now, if running `./gradlew cleanWebpackFiles`, the tasks works as expected.

|                 Before running the cleanWebpackFiles task                 |                After running the cleanWebpackFiles task                 |
|:-------------------------------------------------------------------------:|:-----------------------------------------------------------------------:|
| ![before](react-and-spring-data-rest-basic/images/before_clean_files.png) | ![after](react-and-spring-data-rest-basic/images/after_clean_files.png) |


<br>

### 2.3 Merge tut-basic-gradle branch with main
Now that everything is working, is time to apply all the changes in the main branch.
To reflect this changes in the main branch, switch to the main branch, merge changes from the `tut-basic-gradle` branch into `main` 
with a non-fast-forward merge, and then push the changes to the remote repository.
Note: A non-fast-forward merge preserves the history and clearly indicates that a merge has occurred, even if there are no 
divergent changes between the branches.

```bash
$ git checkout main
$ git merge --no-ff tut-basic-gradle
$ git push origin main
```

<br>

---
## Part 3: Explore an Alternative Solution

In order to practice and try a different solution, Maven was chosen. Although CA1 was already using Maven, the specific 
requested tasks for this assignment and some dependencies were not configured. There are several build tools available for Java projects, 
each with its own strengths and purposes. Below there is a wrap up of some available build tools and some comments to conclude 
why Maven was chosen.  
* **Ant:** Ant is an older build tool that predates Maven. It uses XML-based configuration files `build.xml` and provides a lot 
of flexibility in defining build processes. While it's powerful, it can also be verbose and requires more manual configuration 
compared to Maven.
* **SBT** (Scala Build Tool): SBT is primarily associated with Scala projects, but it's also capable of building Java projects. 
It's based on a domain-specific language (DSL) for build configurations and offers features like incremental compilation 
and interactive development.
* **Apache Buildr:** Aims to simplify the build process using a Ruby-based DSL. It's designed to be flexible and extensible, 
offering features like dependency management, testing, and packaging. Unfortunately, it seems it is not available anymore.

Maven is one of the most widely used build tools for Java projects. It uses XML configuration files (known as `pom.xml`) to manage 
dependencies, build lifecycle, and project information. Maven is often preferred for its convention-based approach and 
extensive ecosystem of plugins.

<br>

To create a Maven project, you can simply copy the `/src` folder, `webpack.config.js` and `package.json` files to a new folder in
your repository. Open your IDE and add a `pom.xml` file to your project. The initial content of the `pom.xml`file used in CA1
can also be reused, so you just need to add the missing dependencies (Thymeleaf, JPA, H2) and requested tasks (copy generated jar file and delete
webpack files). The frontend plugin was already applied in the existing pom file.

In the `dependencies section` add the following dependencies:

```xml
    <dependencies>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-thymeleaf</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-jpa</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-data-rest</artifactId>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-devtools</artifactId>
        </dependency>
        <dependency>
            <groupId>com.h2database</groupId>
            <artifactId>h2</artifactId>
            <scope>runtime</scope>
        </dependency>
        <dependency>
            <groupId>org.springframework.boot</groupId>
            <artifactId>spring-boot-starter-test</artifactId>
            <scope>test</scope>
        </dependency>
    </dependencies>
```

<br>

To add the copy jar file task, in the `build` section, configure the `maven resources plugin` with the following:

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-resources-plugin</artifactId>
    <version>3.2.0</version>
    <executions>
        <execution>
            <id>copy-jar-files</id>
            <phase>package</phase>
            <goals>
                <goal>copy-resources</goal>
            </goals>
            <configuration>
                <outputDirectory>${project.basedir}/dist</outputDirectory>
                <resources>
                    <resource>
                        <directory>${project.build.directory}</directory>
                        <includes>
                            <include>*.jar</include>
                        </includes>
                    </resource>
                </resources>
            </configuration>
        </execution>
    </executions>
</plugin>
```

The build phase assigned was the `package`, where Maven compiles the project's source code and packages the compiled classes
and resources in a JAR or WAR file.  
The field `<outputDirectory>` specifies the directory where the copied resources will be placed
and `${project.build.directory}` specifies the source directory from which resources will be copied,
which is typically the `target` directory where Maven builds your project.   
In this case, it's `${project.basedir}/dist`, which resolves to a directory named `dist` in the project's base directory.   
The `<includes>` section specifies the type of files to be copied.

<br>

To delete the generated webpack files under `/src/main/resources/static/built`, in the `build` section, configure the `maven clean plugin` 
with the following:

```xml
<plugin>
   <artifactId>maven-clean-plugin</artifactId>
   <version>3.1.0</version>
   <executions>
      <execution>
         <id>delete-webpack-files</id>
         <phase>clean</phase>
         <goals>
            <goal>clean</goal>
         </goals>
         <configuration>
            <filesets>
               <fileset>
                  <directory>${project.basedir}/src/main/resources/static/built</directory>
                  <includes>
                     <include>**/*</include>
                  </includes>
               </fileset>
            </filesets>
         </configuration>
      </execution>
   </executions>
</plugin>
```

The build phase assigned was the `clean` one, where the primary purpose is to remove any build artifacts and 
temporary files generated by previous builds.
The sections <filesets> and <directory> specify the directory to be deleted.
The `<executions>` section is not strictly necessary in this case because the clean goal is already bound to the clean phase 
by default. However, explicitly declaring the execution provides clarity and allows for additional configuration if needed in the future,
so it was decided to be added.

To build your project simply run `./mvnw install` and everything should work (verify that your folder `/dist` appears as expected).
To remove the files under `/src/main/resources/static/built` run `./mvnw clean`, and both your files and everything under the target folder
(included the target folder) will be deleted.

<br> 

---
## 4. Useful Sources
* [The Java Plugin](https://docs.gradle.org/current/userguide/java_plugin.html)
* [The Frontend Plugin](https://plugins.gradle.org/plugin/org.siouan.frontend-jdk17)
* [Task Execution](https://docs.gradle.org/current/userguide/controlling_task_execution.html)
* [Building Java Project with Gradle](https://spring.io/guides/gs/gradle)
* [Building Java Project with Maven](https://spring.io/guides/gs/maven)
* [Maven Plugins](https://maven.apache.org/plugins/index.html)
---

